{% set path = path|default('') %}
{% set model = createModel('Files','storage') %}
{% set user_id = access().getId() %}  
{% set filesystem = model.getUserFilesystemName() %}
{% set filesystem_path = model.getUserFilesystemPath(user_id) %}
{% set result = service('storage').mountLocal(filesystem,filesystem_path) %}
{% set filesList = getDirectoryFiles(path,false,filesystem) %}
{% set items = paginate(filesList,'myfiles') %}  

{% set view_type = view_type|default(getViewType('files')) %}

{% if view_type == 'table' %}
<div class="ui big list" id="files_items">
{% else %}
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 lg:grid-cols-7 xl:grid-cols-10 gap-4" id="files_items">
{% endif %}

{% if items.getItems()|length == 0 %}
    <div class="ui item">..</div>
{% endif %}
{% for item in items.getItems() %}
    {%  set file = model.saveFile(item.path,user_id,{ 
            type: item.type,
            size: item.size,
            filesystem: filesystem,
            date_created: item.timestamp,
            mime_type: service('storage').getMimetype(item.path,filesystem)  
        },false) 
    %}
    {% if file.isDirectory() == true %}
        {% set items_count = getDirectoryFiles(item.path,false,filesystem)|length %}
    {% endif %}

    {% if item.path != 'bin' %}
        {% if view_type == 'table' %}
            {{  component('files>files.view.items.item',{ 
                    path: item.path,
                    user_id: user_id,
                    file: file,
                    count: items_count,  
                    trash: trash 
                }) 
            }}
        {% else %}
            {{  component('files>files.view.items.card',{ 
                    path: item.path,
                    user_id: user_id,  
                    count: items_count,                
                    file: file,
                    trash: trash  
                }) 
            }}
        {% endif %}
    {% endif %}
{% endfor %}
</div>